# Веб сервис по подбору рекламных площадок для заданных локаций

## Содержание

1. [Структура данных для хранения локаций и рекламных площадок в оперативной памяти.](#структура-данных-для-хранения-локаций-и-рекламных-площадок-в-оперативной-памяти)
2. [Почему всё реализованно именно так?](#почему-всё-реализованно-именно-так)
3. [ASP\.NET Core приложение с Rest API](#aspnet-core-приложение-c-rest-api)
   - [Использование API](#использование-api)
   - [Установка и запуск](#установка-и-запуск)

## Структура данных для хранения локаций и рекламных площадок в оперативной памяти

Все данные хранятся в дереве. Структура данных на выходе представляет из себя динамическую библиотеку классов (.dll файл), который подключаетя в проект с веб-сервисом. Класс дерева хранит в себе:

1. Ссылка на head элемент дерева.
2. Список, в котором будут хранится названия всех рекламных площадок, которые присутствуют в дереве.

```csharp
public class RegionTree {
	private Node? head;
	private List<string> allAds;

	public RegionTree() {
		// код
	}

	// Функции для работы с деревом //

	public bool isCreated() {
		// код
	}

	public void createTree(string? pathToFile) {
		// код
	}

	public string addNoteToTree(string? note) {
		// код
	}

	public List<string> findNote(string? pathToNote) {
		// код
	}
}
```

Узел дерева представляет из себя Node класс, который хранит в себе:

1. Название узла (представляет фрагмент пути).
2. Индекс рекламы из списка всех рекламных площадок, хрнаимых в дереве.
3. Хэш-таблица, которая хранит в себе все вложенные на 1 уровень регионы в конкретный регион.

```csharp
	private class Node
	{
		private string nodeName;
		private int adIndex;
		private Dictionary<string, Node?> regions = new Dictionary<string, Node?>();
	}
```

Разберём на конкретном примере то, как будет выглядеть дерево.
Допустим есть файл, в котором находятся следующие строки:

> Яндекс.Директ:/ru
> Ревдинский рабочий:/ru/svrd/revda,/ru/svrd/pervik
> Газета уральских москвичей:/ru/msk,/ru/permobl,/ru/chelobl
> Крутая реклама:/ru/svrd

Дерево будет выглядеть следующим образом:

> allAds: ["Яндекс.Директ", "Ревдинский рабочий", "Газета уральских москвичей", "Крутая реклама"]

Соответвенно каждое название рекламной площадки индексируется от 0 до 3.

Node head выглядит следующим образом:

> nodeName: "ru"
> adIndex: 0
> regions:
>
> > svrd: ссылка на Node с названием "svrd"
> > msk: ссылка на Node с названием "msk"
> > permobl: ссылка на Node с названием "permobl"
> > chelobl: ссылка на Node с названием "chelobl"

Node svrd выглядит вот так:

> nodeName: "svrd"
> adIndex: 3
> regions:
>
> > revda: ссылка на Node с названием "revda"
> > pervik: ссылка на Node с названием "pervik"

И так далее...

### Почему всё реализованно именно так?

Зачем один общий список рекламных площадок и зачем храним индекс?
Список всех названий рекламных площадок сделан для экономии памяти, потому что одна рекламная площадка может быть во множетве регионов, а регионов может быть очень много и для каждого региона делать свой string не очень хорошо. Поэтому храним индекс рекламной площадки в каждом регионе.

Зачем хэш-таблица для воженных на 1 уровень регионов?
Подразумевается, что регионов/городов/областей, которые являются вложенными в /ru очень и очень много. Ключом хеш-таблицы является название региона, а значение - ссылка на Node этого региона. Сделано это для того, чтобы обеспечить быстрый переход к следующему региону и соотвественно обеспечить быстрый поиск.

## ASP\.NET Core приложение c Rest API

### Использование API

1.  Загрузка данных из файла
    **Метод:** `POST /api/Ads/upload`
    **Тело запроса:**

    ```
    "string"
    ```

    **Ответ:**

    - `200: OK`:Данные успешно загружены
    - `404 Not Found`: Файл не найден.
    - `400 Bad Request`: Произошла ошибка при загрузке.

    Пример запроса в Postman:

    - URL: `http://localhost:5288/api/ads/upload`
    - Method: `POST`
    - Body (raw, JSON): `"C://path//to//your//file.txt"`

2.  Поиск рекламных площадок по региону
    **Метод:** `GET /api/ads/search`
    **Параметры запроса:**

    `region` (строка): Название региона.

    **Ответ:**

    - `200 OK`: Список рекламных площадок.
    - Пример ответа:

    ```
    [
        "Ad Platform 1",
        "Ad Platform 2"
    ]
    ```

    Пример запроса в Postman:

    - URL для `http`: `http://localhost:5104/api/ads/search?region=/ru/chelobl`
    - Или для `http`: `http://localhost:5000/api/ads/search?region=/ru/chelobl`
    - URL для `https`: `https://localhost:7014/api/ads/search?region=/ru/chelobl`
    - Method: `GET`

### Установка и запуск

1. `git clone` в удобную вам папку
2. Переходите в `.../WebServiceForAdvertisingPlatforms/bin/Release/net8.0/publish`
3. Запускаете `WebServiceForAdvertisingPlatforms.exe`.
4. Если всё успешно, то должна открыться консоль, содержание которой будет примерно следующее:
   > info: Microsoft.Hosting.Lifetime[14]
   > Now listening on: http://localhost:5000
   > info: Microsoft.Hosting.Lifetime[0]
   > Application started. Press Ctrl+C to shut down.
   > info: Microsoft.Hosting.Lifetime[0]
   > Hosting environment: Production
   > info: Microsoft.Hosting.Lifetime[0]
   > Content root path: D:\Институт\TEST\advertising-platforms\WebServiceForAdvertisingPlatforms\bin\Release\net8.0\publish
5. Открываете Postman

   _5.1. Загрузка файла_
   `POST` запрос, вводите следующее: `http://localhost:5000/api/Ads/upload`
   В теле запроса выбираете `Body`, затем `raw` и пишете путь к файлу. Пример: `"D://regions.txt"`
   Если всё успешно, то код будет `200 OK` и будет надпись `Данные успешно загружены.`

   _5.2. Поиск рекламной площадки_
   `GET` запрос, вводите следующее: `http://localhost:5000/api/Ads/search?region=/ru`
   Если всё успешно, то будет код `200 OK`, и если вы туда загружали txt файл, который был приведён в качестве примера выше, то вам будет выведен массив: `["Яндекс.Директ"]`
